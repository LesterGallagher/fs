(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{143:function(e,n,t){},252:function(e,n,t){e.exports=t(474)},259:function(e,n,t){},260:function(e,n,t){e.exports=t.p+"static/media/logo.5d5d9eef.svg"},261:function(e,n,t){},300:function(e,n){},474:function(e,n,t){"use strict";t.r(n);var a=t(0),o=t.n(a),r=t(39),i=t.n(r),c=(t(257),t(258),t(259),t(260),t(261),t(135)),l=t.n(c),s=t(215),u=t(86),d=t(216),m=t(92),f=t(87),p=t(93),h=t(481),g=t(475),w=t(480),E=t(484),b=t(482),v=t(40),y=t(139),k=t(240),S=(t(143),t(4)),O=t.n(S),j=t(241),C=t(140),D=t(218),F=t(88),I=t.n(F),L=function(){return Math.floor(9007199254740992*Math.random()).toString(36)},M=function(e){return{lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate,name:e.name,path:e.path,size:e.size,type:e.type,webkitRelativePath:e.webkitRelativePath}},U=t(219),A=t.n(U),P="https://api.esstudio.site/api/file-sharing/no-persist-open-chat",x=I.a.parse(window.location.search),N=new(function(e){function n(){var e;Object(u.a)(this,n),(e=Object(m.a)(this,Object(f.a)(n).call(this))).files=[],e.users=[],e.handleConnectError=function(){alert("Connection failed")},e.handleSocketInitSuccess=function(n){if(!n)return console.error("Unable to connect");e.socket.on("msg",e.handleMessage),e.socket.on("disconnected",function(n){console.log("disconnect",n),delete e.users[n.from]})},e.downloadFiles=function(n){0!==(n=n.filter(function(e){return!e.downloaded&&!e.downloading})).length&&(e.socket.emit("msg",{type:"DOWNLOAD_FILES",payload:n.map(function(e){return M(e)})}),e.files=e.files.map(function(e){return n.some(function(n){return n.name===e.name})?Object.assign(e,{downloading:!0}):e}),console.log(e.files),e.emit("change"))},e.handleMessage=function(n,t){if(console.log("handle message",n),!n.to||n.to===e.user){switch(n.type){case"ADD_FILES":var a;(a=e.files).push.apply(a,Object(C.a)(n.payload.map(function(e){return Object(j.a)({},e,{downloaded:!1,downloading:!1,user:n.from})})));break;case"DOWNLOAD_FILES":console.log(e.files,n.payload);var o=e.files.filter(function(t){return n.payload.some(function(e){return e.name===t.name})&&t.user===e.user});console.log(o),e.socket.emit("msg",{type:"SEND_FILES",to:n.from,payload:o});break;case"SEND_FILES":e.files=e.files.map(function(e){return Object.assign(n.payload.find(function(n){return e.name===n.name})||e,{downloading:!1})}),e.emit("change")}e.emit("change")}},e.handleSocketConnect=function(){e.socket.emit("init",{room:e.id,nickname:e.user},e.handleSocketInitSuccess),e.socket.on("disconnect",function(){console.warn(" socket disconnect")})},e.addFiles=function(n){var t;(t=e.files).push.apply(t,Object(C.a)(n)),e.socket.emit("msg",{type:"ADD_FILES",payload:n.map(function(e){return M(e)})}),e.emit("change")},e.removeFile=function(n){var t=e.files.indexOf(n);-1!==t&&e.files.splice(t,1),e.emit("change")};var t=!1;try{t=localStorage.getItem("file-share-id")}catch(a){console.error(a)}if(x.id?e.id=x.id:(e.id=L(),window.history&&window.history.pushState&&window.history.replaceState(null,"","?id="+e.id)),t)e.user=t;else{e.user=L();try{localStorage.setItem("file-share-id",e.user)}catch(a){console.error(a)}}return e.socket=A.a.connect(P,{"connect timeout":5e3}),e.socket.on("connect",e.handleSocketConnect),e.socket.on("connect_error",e.handleConnectError),e}return Object(p.a)(n,e),n}(D.EventEmitter)),_=t(220),z=t.n(_),W=t(221),R=t(136),B=t.n(R),H=t(222),J=t(223),T=function(e){function n(e){var t;return Object(u.a)(this,n),(t=Object(m.a)(this,Object(f.a)(n).call(this))).onDrop=function(){var e=Object(s.a)(l.a.mark(function e(n){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(n.map(function(e){return new Response(e).arrayBuffer()}));case 2:t=e.sent,N.addFiles(n.map(function(e,n){return Object.assign(M(e),{buffer:t[n],downloaded:!0,downloading:!1,user:N.user})}));case 4:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}(),t.handleFileStoreChange=function(){t.setState({files:N.files})},t.connect=function(e){var n=Object(F.parse)(t.state.connectUrl).id||t.state.connectUrl;window.location.href=window.location.origin+window.location.pathname+"?id="+n},t.state={files:[],connectUrl:""},t}return Object(p.a)(n,e),Object(d.a)(n,[{key:"componentWillMount",value:function(){N.on("change",this.handleFileStoreChange)}},{key:"componentWillUnmount",value:function(){N.removeListener("change",this.handleFileStoreChange)}},{key:"render",value:function(){var e=this;return console.log(this.state.files),o.a.createElement("div",{className:"Home"},o.a.createElement(k.a,{onDrop:this.onDrop},function(n){var t=n.getRootProps,a=n.getInputProps,r=n.isDragActive;return o.a.createElement("section",null,o.a.createElement(h.a,{trigger:o.a.createElement(g.a,{primary:!0,icon:"play",content:"Connect"})},o.a.createElement(h.a.Header,null,"Connect"),o.a.createElement(h.a.Content,null,o.a.createElement(h.a.Description,null,o.a.createElement("p",null,"Paste in the same URL as the person you want to connect to."),o.a.createElement("p",null,"Simply copy the url bar from the other user, email or message it and paste it here."),o.a.createElement(w.a,{value:e.state.connectUrl,onChange:function(n){return e.setState({connectUrl:n.target.value})},placeholder:"The url"})," ",o.a.createElement(g.a,{onClick:e.connect,primary:!0},"Connect")))),o.a.createElement(g.a,Object.assign({primary:!0,icon:"upload",content:"Upload"},t())),o.a.createElement("div",t({className:O()({dropzone:!0,active:r}),onClick:function(e){return e.stopPropagation()}}),o.a.createElement("input",a()),o.a.createElement(E.a,null,e.state.files.map(function(e){var n=e.downloaded,t=e.downloading,a=e.name,r=e.size,i=e.lastModified,c=(e.user,e.type);return console.log(e),o.a.createElement(E.a.Column,{key:a,computer:3,mobile:6,tablet:9},o.a.createElement(b.a,{style:{textAlign:"center"}},o.a.createElement("span",{className:"file-icon "+z.a.getClass(a)}),o.a.createElement("br",null),a,o.a.createElement("br",null),"Last modified: ",Object(W.format)(i),o.a.createElement("br",null),!n&&o.a.createElement(g.a,{as:"div",labelPosition:"right"},o.a.createElement(g.a,{onClick:function(n){return N.downloadFiles([e])},color:"red"},o.a.createElement(v.a,{name:"download"}),"Download"),o.a.createElement(y.a,{as:"span",basic:!0,color:"red",pointing:"left"},B()(r))),n&&o.a.createElement(g.a,{as:"div",labelPosition:"right"},o.a.createElement(g.a,{onClick:function(n){return Object(J.saveAs)(new Blob([e.buffer],{type:c}))},color:"blue"},o.a.createElement(v.a,{name:"download"}),"Save"),o.a.createElement(y.a,{as:"span",basic:!0,color:"blue",pointing:"left"},B()(r))),o.a.createElement("div",{style:{height:30,padding:5,textAlign:"center"}},o.a.createElement(H.SyncLoader,{sizeUnit:"px",size:20,color:"#1a69a4",loading:t}))))})),o.a.createElement("br",null),o.a.createElement("p",null,"Drag 'n' drop some fancy files.")))}))}}]),n}(a.Component);var $=function(){return o.a.createElement("div",{className:"App"},o.a.createElement(T,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement($,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[252,1,2]]]);
//# sourceMappingURL=main.8b4a8a95.chunk.js.map