(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{312:function(e,n,t){},421:function(e,n,t){e.exports=t(894)},680:function(e,n,t){},681:function(e,n,t){e.exports=t.p+"static/media/logo.5d5d9eef.svg"},682:function(e,n,t){},720:function(e,n){},894:function(e,n,t){"use strict";t.r(n);t(422),t(480);var a=t(0),o=t.n(a),r=t(87),i=t.n(r),c=(t(678),t(679),t(680),t(681),t(682),t(239)),l=t.n(c),s=t(384),u=t(170),d=t(385),m=t(176),f=t(171),p=t(177),h=t(901),g=t(895),E=t(900),w=t(904),y=t(902),b=t(88),v=t(243),k=t(409),S=(t(312),t(5)),O=t.n(S),C=t(410),D=t(244),j=t(387),F=t(172),L=t.n(F),I=function(){return Math.floor(9007199254740992*Math.random()).toString(36)},U=function(e){return{lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate,name:e.name,path:e.path,size:e.size,type:e.type,webkitRelativePath:e.webkitRelativePath}},A=t(388),M=t.n(A),_="https://api.esstudio.site/api/file-sharing/no-persist-open-chat",P=L.a.parse(window.location.search),x=new(function(e){function n(){var e;Object(u.a)(this,n),(e=Object(m.a)(this,Object(f.a)(n).call(this))).init=function(){e.socket&&e.socket.disconnect(),e.socket=M.a.connect(_,{"connect timeout":5e3}),e.socket.on("connect",e.handleSocketConnect),e.socket.on("connect_error",e.handleConnectError)},e.changeRoom=function(n){e.id=n,console.log("change page",n),e.init(),window.history&&window.history.replaceState(null,"","?id="+e.id)},e.files=[],e.users=[],e.handleConnectError=function(){alert("Connection failed")},e.handleSocketInitSuccess=function(n){if(!n)return console.error("Unable to connect");e.socket.on("msg",e.handleMessage),e.socket.on("disconnected",function(n){console.log("disconnect",n),delete e.users[n.from],e.files.some(function(e){return e.user===n.from})&&(e.files=e.files.filter(function(e){return e.user!==n.from}),e.emit("change"))}),e.socket.emit("msg",{type:"GET_FILES"})},e.downloadFiles=function(n){0!==(n=n.filter(function(e){return!e.downloaded&&!e.downloading})).length&&(e.socket.emit("msg",{type:"DOWNLOAD_FILES",payload:n.map(function(e){return U(e)})}),e.files=e.files.map(function(e){return n.some(function(n){return n.name===e.name})?Object.assign(e,{downloading:!0}):e}),console.log(e.files),e.emit("change"))},e.handleMessage=function(n,t){if(console.log("handle message",n),!n.to||n.to===e.user){switch(n.type){case"GET_FILES":e.socket.emit("msg",{type:"ADD_FILES",to:n.from,payload:e.files.filter(function(n){return n.user===e.user})});break;case"ADD_FILES":var a;(a=e.files).push.apply(a,Object(D.a)(n.payload.map(function(e){return Object(C.a)({},e,{downloaded:!1,downloading:!1,user:n.from})})));break;case"DOWNLOAD_FILES":console.log(e.files,n.payload);var o=e.files.filter(function(t){return n.payload.some(function(e){return e.name===t.name})&&t.user===e.user});console.log(o),e.socket.emit("msg",{type:"SEND_FILES",to:n.from,payload:o});break;case"SEND_FILES":e.files=e.files.map(function(e){return Object.assign(n.payload.find(function(n){return e.name===n.name})||e,{downloading:!1})});break;default:return}e.emit("change")}},e.handleSocketConnect=function(){e.socket.emit("init",{room:e.id,nickname:e.user},e.handleSocketInitSuccess),e.socket.on("disconnect",function(){console.warn(" socket disconnect")})},e.addFiles=function(n){var t;(t=e.files).push.apply(t,Object(D.a)(n)),e.socket.emit("msg",{type:"ADD_FILES",payload:n.map(function(e){return U(e)})}),e.emit("change")},e.removeFile=function(n){var t=e.files.indexOf(n);-1!==t&&e.files.splice(t,1),e.emit("change")},P.id?e.id=P.id:(e.id=I(),window.history&&window.history.pushState&&window.history.replaceState(null,"","?id="+e.id));var t=!1;try{t=localStorage.getItem("file-share-id")}catch(a){console.error(a)}if(t)e.user=t;else{e.user=I();try{localStorage.setItem("file-share-id",e.user)}catch(a){console.error(a)}}return console.log("userid",e.user),e.init(),e}return Object(p.a)(n,e),n}(j.EventEmitter)),N=t(389),R=t.n(N),z=t(390),W=t(240),B=t.n(W),T=t(391),G=t(392),H=function(e){function n(e){var t;return Object(u.a)(this,n),(t=Object(m.a)(this,Object(f.a)(n).call(this))).onDrop=function(){var e=Object(s.a)(l.a.mark(function e(n){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(n.map(function(e){return new Response(e).arrayBuffer()}));case 2:t=e.sent,x.addFiles(n.map(function(e,n){return Object.assign(U(e),{buffer:t[n],downloaded:!0,downloading:!1,user:x.user})}));case 4:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}(),t.handleFileStoreChange=function(){t.setState({files:x.files})},t.connect=function(e){var n=Object(F.parse)(new URL(t.state.connectUrl,window.location.href).search).id||t.state.connectUrl;x.changeRoom(n),t.setState({open:!1})},t.state={files:[],connectUrl:"",open:!1},t}return Object(p.a)(n,e),Object(d.a)(n,[{key:"componentWillMount",value:function(){x.on("change",this.handleFileStoreChange)}},{key:"componentWillUnmount",value:function(){x.removeListener("change",this.handleFileStoreChange)}},{key:"render",value:function(){var e=this;return console.log(this.state.files),o.a.createElement("div",{className:"Home"},o.a.createElement(k.a,{onDrop:this.onDrop},function(n){var t=n.getRootProps,a=n.getInputProps,r=n.isDragActive;return o.a.createElement("section",null,o.a.createElement(h.a,{onClose:function(n){return e.setState({open:!1})},open:e.state.open,trigger:o.a.createElement(g.a,{onClick:function(n){return e.setState({open:!0})},primary:!0,icon:"play",content:"Connect"})},o.a.createElement(h.a.Header,null,"Connect"),o.a.createElement(h.a.Content,null,o.a.createElement(h.a.Description,null,o.a.createElement("p",null,"Paste in the same URL as the person you want to connect to."),o.a.createElement("p",null,"Simply copy the url bar from the other user, email or message it and paste it here."),o.a.createElement(E.a,{value:e.state.connectUrl,onChange:function(n){return e.setState({connectUrl:n.target.value})},placeholder:"The url"})," ",o.a.createElement(g.a,{onClick:e.connect,primary:!0},"Connect")))),o.a.createElement(g.a,Object.assign({primary:!0,icon:"upload",content:"Upload"},t())),o.a.createElement("div",t({className:O()({dropzone:!0,active:r}),onClick:function(e){return e.stopPropagation()}}),o.a.createElement("input",a()),o.a.createElement(w.a,null,e.state.files.map(function(e){var n=e.downloaded,t=e.downloading,a=e.name,r=e.size,i=e.lastModified,c=(e.user,e.type);return console.log(e),o.a.createElement(w.a.Column,{key:a,computer:3,mobile:6,tablet:9},o.a.createElement(y.a,{style:{textAlign:"center"}},o.a.createElement("span",{className:"file-icon "+R.a.getClass(a)}),o.a.createElement("br",null),a,o.a.createElement("br",null),"Last modified: ",Object(z.format)(i),o.a.createElement("br",null),!n&&o.a.createElement(g.a,{as:"div",labelPosition:"right"},o.a.createElement(g.a,{onClick:function(n){return x.downloadFiles([e])},color:"red"},o.a.createElement(b.a,{name:"download"}),"Download"),o.a.createElement(v.a,{as:"span",basic:!0,color:"red",pointing:"left"},B()(r))),n&&o.a.createElement(g.a,{as:"div",labelPosition:"right"},o.a.createElement(g.a,{onClick:function(n){return Object(G.saveAs)(new Blob([e.buffer],{type:c}))},color:"blue"},o.a.createElement(b.a,{name:"download"}),"Save"),o.a.createElement(v.a,{as:"span",basic:!0,color:"blue",pointing:"left"},B()(r))),o.a.createElement("div",{style:{height:30,padding:5,textAlign:"center"}},o.a.createElement(T.SyncLoader,{sizeUnit:"px",size:20,color:"#1a69a4",loading:t}))))})),o.a.createElement("br",null),o.a.createElement("p",null,"Drag 'n' drop some fancy files.")))}))}}]),n}(a.Component);var J=function(){return o.a.createElement("div",{className:"App"},o.a.createElement(H,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(J,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[421,1,2]]]);
//# sourceMappingURL=main.6a22fa28.chunk.js.map